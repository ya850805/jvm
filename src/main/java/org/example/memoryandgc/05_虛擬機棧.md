# 虛擬機棧

虛擬機棧概述
------------

### 背景

* 由於跨平台的設計，Java的指令都是根據棧來設計的。不同平台CPU架構不同，所以不能設計為基於寄存器的。
* **優點是跨平台，指令集小，編譯器容易實現，缺點是性能下降，實現同樣的功能需要更多指令**。

### 內存中的棧與堆

* **棧是運行時的單位，堆是存儲的單位**。
* 棧解決程序的運行問題，即程序如何執行，或者說如何處理數據。堆解決的是數據存儲的問題，即數據怎麼放、放在哪。

![image.png](./assets/1711007255822-image.png)

### 虛擬機棧基本內容

* Java虛擬機棧是什麼？
  * Java虛擬機棧(Java Virtual Machine Stack)，早期也叫Java棧。每個線程在創建時都會創建一個虛擬機棧，**其內部保存一個個的棧幀(Stack Frame)，對應一次次的方法調用**，棧是線程私有的。:point_right:參考[StackTest.java](chapter05/StackTest.java)
    ![image.png](./assets/1711007886473-image.png)
* 生命週期
  * 生命週期和線程一致。
* 作用
  * 主管Java程序的運行，保存方法的局部變量(8種基本數據類型、對象的引用地址)、部分結果，並參與方法的調用和返回。
  * 局部變量，他是相比於成員變量(屬性)的。
  * 基本數據變量 vs 引用類型變量(類、數組、接口)

### 虛擬機棧特點

* 棧是一種快速有效的分配存儲方式，訪問速度僅次於程序計數器。
* JVM直接對Java棧的操作只有2個：
  * 每個方法執行，伴隨著**進棧**(入棧、壓棧)。
  * 執行結束後的**出棧**工作。
* 對於棧來說不存在垃圾回收問題。
  * **棧不存在GC，但是可能存在OOM**。

![image.png](./assets/1711008249349-image.png)



